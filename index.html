<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>AR модель — model-viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- model-viewer -->
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

  <style>
    html, body { height: 100%; margin: 0; background:#111; }
    model-viewer { width: 100%; height: 100%; background: #111; }
  </style>
</head>
<body>

  <!-- Просмотрщик -->
  <model-viewer
    src="/Models/Step.glb"
    alt="БРАЕР Step"
    ar
    ar-modes="webxr scene-viewer quick-look"
    ar-scale="auto"
    camera-controls
    auto-rotate
    shadow-intensity="0"
    exposure="0.65"
    tone-mapping="neutral"  <!-- дефолт как в демо -->
    disable-zoom>
    <button slot="ar-button" style="
      position:absolute; left:50%; bottom:16px; transform:translateX(-50%);
      padding:12px 18px; border:0; border-radius:12px; font:600 16px system-ui;
      background:#fff; color:#111; cursor:pointer;">
      Открыть в AR
    </button>
    <div slot="poster" style="
      display:flex; align-items:center; justify-content:center; height:100%; color:#aaa;">
      Загрузка модели…
    </div>
  </model-viewer>

  <!-- Панель Tone Mapping -->
  <div id="tonePanel" style="
    position:fixed; right:16px; top:16px; z-index:10;
    display:flex; gap:8px; align-items:center;
    background:rgba(0,0,0,.6); backdrop-filter: blur(6px);
    padding:8px 12px; border-radius:12px; color:#fff; font:500 14px system-ui;">
    <label for="tone" style="white-space:nowrap;">Tone Mapping:</label>
    <select id="tone" style="background:#111; color:#fff; border:1px solid #333; border-radius:8px; padding:6px 8px;">
      <option value="neutral">Neutral</option>
      <option value="aces">ACES</option>
      <option value="agx">AgX</option>
      <option value="cineon">Cineon</option>
      <option value="reinhard">Reinhard</option>
      <option value="linear">Linear</option>
      <option value="none">None</option>
    </select>
  </div>

  <script>
  // Скрипт после <model-viewer>, чтобы элемент уже был в DOM
  (() => {
    const mv = document.querySelector('model-viewer');
    const toneSel = document.getElementById('tone');

    function applyTone() {
      // обновляем превью немедленно
      mv.toneMapping = toneSel.value;
      // чтобы пересчёт точно отрисовался
      mv.requestUpdate('tone-mapping');
    }

    function syncFromMV() {
      // выставляем селект = текущему значению компонента
      try { toneSel.value = mv.toneMapping || 'neutral'; } catch {}
      applyTone();
    }

    toneSel.addEventListener('input', applyTone);

    if (mv.model) syncFromMV();
    else mv.addEventListener('load', syncFromMV, { once: true });
  })();
  </script>

</body>
</html>
